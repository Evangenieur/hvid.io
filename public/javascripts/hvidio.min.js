(function(){var i,k,h,c=0,d=$("#main"),n=$("#form"),b=$("#keyword"),m=$("#results"),f=$("#player"),l=$("#close"),a=$("#header"),g=$("#clickjack");window.hvidio={init:function(){i=new CanvasLoader("loading");
i.setColor("#99CC32");i.setDiameter(32);i.setDensity(32);i.setRange(0.6);i.setSpeed(1);if(window.location.hash){setTimeout(function(){$("#keyword").val(window.location.hash.substr(1));
$("#form").submit();},200);}else{b.focus();}k=io.connect("http://"+window.location.host);k.on("connect",function(){Search.com_init(k);});g.on("click",function(o){hvidio.show();
o.stopPropagation();o.preventDefault();});d.on("click",function(o){hvidio.hide();o.stopPropagation();o.preventDefault();});b.on("click",function(o){o.stopPropagation();
});m.on("click",".play",function(o){hvidio.play($(this).attr("href"));o.preventDefault();});$(window).on("resize",function(){hvidio.resize();});n.on("submit",function(p){var o=b.val();
hvidio.search(o);window.location.hash="#"+o;p.preventDefault();});$(document).bind("keydown",function(p){var o=p.target.tagName.toLowerCase();if(o!="input"&&o!="textarea"){switch(p.keyCode){case 27:hvidio.toggle();
p.preventDefault();break;case 37:hvidio.prev();p.preventDefault();break;case 38:hvidio.prev();p.preventDefault();break;case 39:hvidio.next();p.preventDefault();
break;case 40:hvidio.next();p.preventDefault();break;case 9:hvidio.show();b.focus().select();p.preventDefault();break;}}});d.addClass("bounceIn");return this;
},initScroller:function(o){if(!h||o){m.mCustomScrollbar();h=true;}else{m.mCustomScrollbar("update");}return this;},initTimer:function(){$(window).on("mousemove keydown",function(){clearTimeout(timer);
timer=setTimeout(function(){hvidio.hide();},10000);});return this;},search:function(o){if(o){this.keyword=o;console.log(this);hvidio.loading(true);hvidio.fetch(o,function(p){d.addClass("large");
hvidio.templatize("#videosTemplate",{search:j(o),videos:p},"#results");hvidio.play(p[0].embed).initScroller().initTimer();l.fadeIn(5000);});}return this;
},order:function(o){console.log("order",o,this.keyword,$("#results"));hvidio.templatize("#videosTemplate",{search:j(this.keyword),videos:o},"#results");
hvidio.loading(false);hvidio.play(o[0].embed);hvidio.initScroller(true);l.fadeIn(5000);},fetch:function(p,q){var o=this;search=Search(p).on("video.new",function(){var u;
this.msg=this.msgs[0];this.score=_.reduce(this.msgs,function(v,w){return(v+(parseInt(w.votes)+1))||1;},0);this.date=this.msgs[0].post_date;if((u=this.embed.indexOf("?"))!=-1){this.embed=this.embed.substr(0,u);
}$("#counter").text(c++);if(typeof search.initiated=="undefined"){search.initiated=true;scroll=false;q([this]);}else{var t=hvidio.templatize("#videoTemplate",{video:this});
var s=$("#video-list-"+j(p));var r=$(t);s.append(r);hvidio.initScroller();r.css("visibility","visible").hide().fadeIn("slow");}}).on("video.update",function(){console.log("update",this.dom_id);
var s=$("#"+this.dom_id+" .tip"),r=parseInt(s.text())||1,t=r+1;s.text(t+"+");s.addClass("incremented animated bounce");}).on("finished",function(){console.log("FINISHED");
hvidio.loading(false);o.order(search.videos_by_date());});return this;},templatize:function(r,s,p){var o=$(r).html(),q=_.template(o,s);if(p){$(p).html(q);
}$("time").timeago();hvidio.resize();hvidio.fadeImg();return q;},loading:function(o){if(o){i.show();}else{i.hide();}return this;},toggle:function(){if(d.is(":visible")){hvidio.hide();
}else{hvidio.show();}return this;},show:function(){d.removeClass("bounceIn fadeOutUp fadeOutDown");d.addClass("fadeInUp").show();return this;},hide:function(){d.removeClass("bounceIn fadeOutUp fadeOutDown");
d.addClass("fadeOutDown");setTimeout(function(){d.hide();},500);return this;},fadeImg:function(o){$("#results img").each(function(){$(this).on("load",function(){$(this).css("visibility","visible").hide().fadeIn("slow");
});});return this;},play:function(o){m.find(".video").removeClass("current");m.find('a[href="'+o+'"]').closest(".video").addClass("current");if(o.indexOf("?")==-1){o+="?";
}else{o+="&";}o+="wmode=transparent&autoplay=1&autohide=1";f.attr("src",o);return this;},jump:function(o){var p=$(".video").eq(o).find(".play").attr("href");
hvidio.play(p);},next:function(){var o=$(".current").index(".video");o++;if(o>$(".video").size()-1){o=0;m.mCustomScrollbar("scrollTo",0);}hvidio.jump(o);
},prev:function(){var o=$(".current").index(".video");o--;if(o<0){o=$(".video").size()-1;m.mCustomScrollbar("scrollTo",20000);}hvidio.jump(o);},resize:function(){var o=d.height(),p=a.outerHeight();
m.outerHeight(o-p-20);var s=d.width(),q=m.find("li").outerWidth(true),r=(Math.floor(s/q))*q;m.find(".video-list").width(r);}};var j=function(o){return o.replace(/\s/g,"_").replace(/:/g,"-").replace(/\\/g,"-").replace(/\//g,"-").replace(/[^a-zA-Z0-9\-_]+/g,"").replace(/-{2,}/g,"-").toLowerCase();
};var e=_.template;_.template=function(p,o){return e(p.replace(/<%\s*include\s*(.*?)\s*%>/g,function(q,r){var s=$("#"+r);return s?s.html():"";}),o);};})();
$(function(){hvidio.init();});