(function(){var k,m,i,c=0,f,d=$("#main"),p=$("#form"),b=$("#keyword"),o=$("#results"),g=$("#player"),n=$("#close"),a=$("#header"),j=$("#hashtags"),h=$("#clickjack");
window.hvidio={init:function(){k=new CanvasLoader("loading");k.setColor("#99CC32");k.setDiameter(32);k.setDensity(32);k.setRange(0.6);k.setSpeed(1);if(window.location.hash){setTimeout(function(){$("#keyword").val(window.location.hash.substr(1));
$("#form").submit();},200);}else{b.focus();}m=io.connect("http://"+window.location.host);m.on("connect",function(){Search.com_init(m);});h.on("click",function(q){hvidio.show();
q.stopPropagation();q.preventDefault();});d.on("click",function(q){hvidio.hide();q.stopPropagation();});d.on("click","a",function(q){q.stopPropagation();
});b.on("click",function(q){q.stopPropagation();});o.on("click",".play",function(q){hvidio.play($(this).attr("href"));q.preventDefault();});$(window).on("resize",function(){hvidio.resize();
});p.on("submit",function(r){var q=b.val();hvidio.search(q);window.location.hash="#"+q;r.preventDefault();});$(document).bind("keydown",function(r){var q=r.target.tagName.toLowerCase();
if(q!="input"&&q!="textarea"){switch(r.keyCode){case 27:hvidio.toggle();r.preventDefault();break;case 37:hvidio.prev();r.preventDefault();break;case 38:hvidio.prev();
r.preventDefault();break;case 39:hvidio.next();r.preventDefault();break;case 40:hvidio.next();r.preventDefault();break;case 9:hvidio.show();b.focus().select();
r.preventDefault();break;}}});d.addClass("bounceIn");hvidio.hashtags();return this;},initScroller:function(q){if(!i||q){o.mCustomScrollbar();i=true;}else{o.mCustomScrollbar("update");
}return this;},initTimer:function(){$(window).on("mousemove keydown",function(){clearTimeout(f);f=setTimeout(function(){hvidio.hide();},20000);});return this;
},search:function(q){if(q){this.keyword=q;console.log(this);hvidio.loading(true);hvidio.fetch(q,function(r){d.addClass("large");hvidio.templatize("#videosTemplate",{search:l(q),videos:r},"#results");
hvidio.play(r[0].embed).initScroller().initTimer();n.show();});}return this;},order:function(q){console.log("order",q,this.keyword,$("#results"));hvidio.templatize("#videosTemplate",{search:l(this.keyword),videos:q},"#results");
hvidio.loading(false).play(q[0].embed).initScroller(true);},fetch:function(r,s){var q=this;search=Search(r).on("video.new",function(){var w;if((w=this.embed.indexOf("?"))!=-1){this.embed=this.embed.substr(0,w);
}$("#counter").text(c++);if(typeof search.initiated=="undefined"){search.initiated=true;s([this]);}else{var v=hvidio.templatize("#videoTemplate",{video:this}),u=$("#video-list-"+l(r)),t=$(v);
u.append(t);hvidio.initScroller();t.css("visibility","visible").hide().fadeIn("slow");}}).on("video.update",function(){console.log("update",this.dom_id);
var t=$("#"+this.dom_id+" .tip");t.text(this.score+"+");t.addClass("incremented animated bounce");}).on("finished",function(){console.log("FINISHED");hvidio.loading(false);
q.order(search.videos_by_date());});return this;},templatize:function(t,u,r){var q=$(t).html(),s=_.template(q,u);if(r){$(r).html(s);}$("time").timeago();
hvidio.resize();hvidio.fadeImg();return s;},loading:function(q){if(q){k.show();}else{k.hide();}return this;},hashtags:function(){var q=p.offset();j.css("top",(q.top+(j.outerHeight()/6))+"px").css("left",(q.left+(b.width()-70))+"px").fadeIn();
},toggle:function(){if(d.is(":visible")){hvidio.hide();}else{hvidio.show();}return this;},show:function(){d.removeClass("bounceIn fadeOutUp fadeOutDown");
d.addClass("fadeInUp").show();return this;},hide:function(){d.removeClass("bounceIn fadeOutUp fadeOutDown");d.addClass("fadeOutDown");setTimeout(function(){d.hide();
},500);return this;},fadeImg:function(q){$("#results img").each(function(){$(this).on("load",function(){$(this).css("visibility","visible").hide().fadeIn("slow");
});});return this;},play:function(q){o.find(".video").removeClass("current");o.find('a[href="'+q+'"]').closest(".video").addClass("current");if(q.indexOf("?")==-1){q+="?";
}else{q+="&";}q+="wmode=transparent&autoplay=1&autohide=1";g.attr("src",q);return this;},jump:function(q){var r=$(".video").eq(q).find(".play").attr("href");
hvidio.play(r);},next:function(){var q=$(".current").index(".video");q++;if(q>$(".video").size()-1){q=0;o.mCustomScrollbar("scrollTo",0);}hvidio.jump(q);
},prev:function(){var q=$(".current").index(".video");q--;if(q<0){q=$(".video").size()-1;o.mCustomScrollbar("scrollTo",20000);}hvidio.jump(q);},resize:function(){var q=d.height(),r=a.outerHeight();
o.outerHeight(q-r-20);var u=d.width(),s=o.find("li").outerWidth(true),t=(Math.floor(u/s))*s;o.find(".video-list").width(t);hvidio.hashtags();}};var l=function(q){return q.replace(/\s/g,"_").replace(/:/g,"-").replace(/\\/g,"-").replace(/\//g,"-").replace(/[^a-zA-Z0-9\-_]+/g,"").replace(/-{2,}/g,"-").toLowerCase();
};var e=_.template;_.template=function(r,q){return e(r.replace(/<%\s*include\s*(.*?)\s*%>/g,function(s,t){var u=$("#"+t);return u?u.html():"";}),q);};})();
$(function(){hvidio.init();});