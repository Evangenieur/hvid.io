(function(){var j,l,i,c=0,f,d=$("#main"),o=$("#form"),b=$("#keyword"),n=$("#results"),g=$("#player"),m=$("#close"),a=$("#header"),h=$("#clickjack");window.hvidio={init:function(){j=new CanvasLoader("loading");
j.setColor("#99CC32");j.setDiameter(32);j.setDensity(32);j.setRange(0.6);j.setSpeed(1);if(window.location.hash){setTimeout(function(){$("#keyword").val(window.location.hash.substr(1));
$("#form").submit();},200);}else{b.focus();}l=io.connect("http://"+window.location.host);l.on("connect",function(){Search.com_init(l);});h.on("click",function(p){hvidio.show();
p.stopPropagation();p.preventDefault();});d.on("click",function(p){hvidio.hide();p.stopPropagation();p.preventDefault();});b.on("click",function(p){p.stopPropagation();
});n.on("click",".play",function(p){hvidio.play($(this).attr("href"));p.preventDefault();});$(window).on("resize",function(){hvidio.resize();});o.on("submit",function(q){var p=b.val();
hvidio.search(p);window.location.hash="#"+p;q.preventDefault();});$(document).bind("keydown",function(q){var p=q.target.tagName.toLowerCase();if(p!="input"&&p!="textarea"){switch(q.keyCode){case 27:hvidio.toggle();
q.preventDefault();break;case 37:hvidio.prev();q.preventDefault();break;case 38:hvidio.prev();q.preventDefault();break;case 39:hvidio.next();q.preventDefault();
break;case 40:hvidio.next();q.preventDefault();break;case 9:hvidio.show();b.focus().select();q.preventDefault();break;}}});d.addClass("bounceIn");return this;
},initScroller:function(p){if(!i||p){n.mCustomScrollbar();i=true;}else{n.mCustomScrollbar("update");}return this;},initTimer:function(){$(window).on("mousemove keydown",function(){clearTimeout(f);
f=setTimeout(function(){hvidio.hide();},20000);});return this;},search:function(p){if(p){this.keyword=p;console.log(this);hvidio.loading(true);hvidio.fetch(p,function(q){d.addClass("large");
hvidio.templatize("#videosTemplate",{search:k(p),videos:q},"#results");hvidio.play(q[0].embed).initScroller().initTimer();m.fadeIn(5000);});}return this;
},order:function(p){console.log("order",p,this.keyword,$("#results"));hvidio.templatize("#videosTemplate",{search:k(this.keyword),videos:p},"#results");
hvidio.loading(false);hvidio.play(p[0].embed);hvidio.initScroller(true);m.fadeIn(5000);},fetch:function(q,r){var p=this;search=Search(q).on("video.new",function(){var v;
this.msg=this.msgs[0];this.score=_.reduce(this.msgs,function(w,x){return(w+(parseInt(x.votes)+1))||1;},0);this.date=this.msgs[0].post_date;if((v=this.embed.indexOf("?"))!=-1){this.embed=this.embed.substr(0,v);
}$("#counter").text(c++);if(typeof search.initiated=="undefined"){search.initiated=true;scroll=false;r([this]);}else{var u=hvidio.templatize("#videoTemplate",{video:this});
var t=$("#video-list-"+k(q));var s=$(u);t.append(s);hvidio.initScroller();s.css("visibility","visible").hide().fadeIn("slow");}}).on("video.update",function(){console.log("update",this.dom_id);
var t=$("#"+this.dom_id+" .tip"),s=parseInt(t.text())||1,u=s+1;t.text(u+"+");t.addClass("incremented animated bounce");}).on("finished",function(){console.log("FINISHED");
hvidio.loading(false);p.order(search.videos_by_date());});return this;},templatize:function(s,t,q){var p=$(s).html(),r=_.template(p,t);if(q){$(q).html(r);
}$("time").timeago();hvidio.resize();hvidio.fadeImg();return r;},loading:function(p){if(p){j.show();}else{j.hide();}return this;},toggle:function(){if(d.is(":visible")){hvidio.hide();
}else{hvidio.show();}return this;},show:function(){d.removeClass("bounceIn fadeOutUp fadeOutDown");d.addClass("fadeInUp").show();return this;},hide:function(){d.removeClass("bounceIn fadeOutUp fadeOutDown");
d.addClass("fadeOutDown");setTimeout(function(){d.hide();},500);return this;},fadeImg:function(p){$("#results img").each(function(){$(this).on("load",function(){$(this).css("visibility","visible").hide().fadeIn("slow");
});});return this;},play:function(p){n.find(".video").removeClass("current");n.find('a[href="'+p+'"]').closest(".video").addClass("current");if(p.indexOf("?")==-1){p+="?";
}else{p+="&";}p+="wmode=transparent&autoplay=1&autohide=1";g.attr("src",p);return this;},jump:function(p){var q=$(".video").eq(p).find(".play").attr("href");
hvidio.play(q);},next:function(){var p=$(".current").index(".video");p++;if(p>$(".video").size()-1){p=0;n.mCustomScrollbar("scrollTo",0);}hvidio.jump(p);
},prev:function(){var p=$(".current").index(".video");p--;if(p<0){p=$(".video").size()-1;n.mCustomScrollbar("scrollTo",20000);}hvidio.jump(p);},resize:function(){var p=d.height(),q=a.outerHeight();
n.outerHeight(p-q-20);var t=d.width(),r=n.find("li").outerWidth(true),s=(Math.floor(t/r))*r;n.find(".video-list").width(s);}};var k=function(p){return p.replace(/\s/g,"_").replace(/:/g,"-").replace(/\\/g,"-").replace(/\//g,"-").replace(/[^a-zA-Z0-9\-_]+/g,"").replace(/-{2,}/g,"-").toLowerCase();
};var e=_.template;_.template=function(q,p){return e(q.replace(/<%\s*include\s*(.*?)\s*%>/g,function(r,s){var t=$("#"+s);return t?t.html():"";}),p);};})();
$(function(){hvidio.init();});